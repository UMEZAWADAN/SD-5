<div class="section">

  <h3 class="section-title">DASC-21 評価</h3>

  <!-- 基本情報 -->
  <div class="sub-section">
    <table class="info-table">
      <tr>
        <th>氏名</th>
        <td><input type="text"></td>

        <th>生年月日</th>
        <td>
          <div class="input-row">
            <input type="text" class="num"> 年
            <input type="text" class="num"> 月
            <input type="text" class="num"> 日
            <input type="text" class="num"> 歳
          </div>
        </td>
      </tr>
      <tr>
        <th>性別</th>
        <td>
          <label><input type="radio" name="d_gender"> 男</label>
          <label><input type="radio" name="d_gender"> 女</label>
        </td>

        <th>情報提供者</th>
        <td><input type="text"></td>
      </tr>
    </table>
  </div>

  <!-- 評価項目 -->
  <div class="sub-section">
    <table class="assessment-table wide">
      <thead>
        <tr>
          <th style="width:50px;">No</th>
          <th>質問項目</th>
          <th>1点</th>
          <th>2点</th>
          <th>3点</th>
          <th>4点</th>
          <th style="width:120px;">分類</th>
          <th style="width:150px;">備考</th>
        </tr>
      </thead>

      <tbody>

        <!-- A・B 導入質問 -->
        <tr>
          <td>A</td>
          <td>もの忘れが多いと感じますか</td>
          <td><input type="radio" name="qA" class="score"></td>
          <td><input type="radio" name="qA" class="score"></td>
          <td><input type="radio" name="qA" class="score"></td>
          <td><input type="radio" name="qA" class="score"></td>
          <td>導入質問（採点なし）</td>
          <td><textarea></textarea></td>
        </tr>

        <tr>
          <td>B</td>
          <td>1年前と比べて、もの忘れが増えましたか</td>
          <td><input type="radio" name="qB" class="score"></td>
          <td><input type="radio" name="qB" class="score"></td>
          <td><input type="radio" name="qB" class="score"></td>
          <td><input type="radio" name="qB" class="score"></td>
          <td>導入質問（採点なし）</td>
          <td><textarea></textarea></td>
        </tr>

        <!-- 1〜21 -->
        {% for i, question, category in [
          (1, "財布や鍵などの置き場所がわからなくなることがありますか", "記憶"),
          (2, "5分前に聞いた話を思い出せないことがありますか", "近時記憶"),
          (3, "自分の生年月日がわからなくなることがありますか", "遠隔記憶"),
          (4, "今日が何月何日かわからないときがありますか", "時間見当識"),
          (5, "自分のいる場所がわからなくなることがありますか", "場所見当識"),
          (6, "道に迷って帰れなくなることがありますか", "道順見当識"),
          (7, "電気やガスなどのトラブルに適切に対処できますか", "問題解決"),
          (8, "一日の計画を自分で立てられますか", "社会的判断力"),
          (9, "季節や状況に合った服を選べますか", "社会的判断力"),
          (10, "一人で買い物ができますか", "家庭外IADL"),
          (11, "公共交通機関を使って外出できますか", "家庭外IADL"),
          (12, "お金の管理ができますか", "家庭外IADL"),
          (13, "電話をかけることができますか", "家庭内IADL"),
          (14, "食事の準備ができますか", "家庭内IADL"),
          (15, "薬を適切に飲めますか", "家庭内IADL"),
          (16, "入浴は一人でできますか", "身体ADL①"),
          (17, "着替えは一人でできますか", "身体ADL①"),
          (18, "トイレは一人でできますか", "身体ADL②"),
          (19, "身だしなみを整えられますか", "身体ADL②"),
          (20, "食事は一人でできますか", "身体ADL②"),
          (21, "家の中を自力で移動できますか", "身体ADL②")
        ] %}
        <tr>
          <td>{{ i }}</td>
          <td>{{ question }}</td>
          <td><input type="radio" name="q{{ i }}" value="1" class="score"></td>
          <td><input type="radio" name="q{{ i }}" value="2" class="score"></td>
          <td><input type="radio" name="q{{ i }}" value="3" class="score"></td>
          <td><input type="radio" name="q{{ i }}" value="4" class="score"></td>
          <td>{{ category }}</td>
          <td><textarea></textarea></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- 結果 -->
  <div class="sub-section">
    <div class="result-box">
      <strong>評価結果：</strong>
      <span id="dasc_score">--</span> / 84 点
      <p id="dasc_comment" class="mt10 muted">まだ評価されていません。</p>
    </div>

    <div class="button-row">
      <button type="button" class="btn primary" onclick="calcDasc()">結果を計算</button>
      <button type="button" class="btn">保存</button>
    </div>
  </div>
</div>

<script>
function calcDasc() {
  let total = 0;
  const checked = document.querySelectorAll('.section input[type="radio"]:checked');

  checked.forEach(r => {
    total += Number(r.value || 0);
  });

  document.getElementById("dasc_score").textContent = total;

  let c = "";
  if (total <= 39) c = "軽度の認知症の可能性があります。";
  else if (total <= 60) c = "中等度の認知機能低下がみられます。";
  else c = "日常生活に支障が出ている可能性があります。";

  document.getElementById("dasc_comment").textContent = c;
}
</script>
