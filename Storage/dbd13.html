<div class="section">

  <h3 class="section-title">DBD-13 評価</h3>

  <!-- 基本情報 -->
  <div class="sub-section">
    <table class="info-table">
      <tr>
        <th>氏名</th>
        <td><input type="text"></td>

        <th>生年月日</th>
        <td>
          <div class="input-row">
            <input type="text" class="num"> 年
            <input type="text" class="num"> 月
            <input type="text" class="num"> 日
            <input type="text" class="num"> 歳
          </div>
        </td>
      </tr>

      <tr>
        <th>性別</th>
        <td>
          <label><input type="radio" name="dbd_gender"> 男</label>
          <label><input type="radio" name="dbd_gender"> 女</label>
        </td>

        <th>情報提供者</th>
        <td><input type="text"></td>
      </tr>
    </table>
  </div>

  <!-- 評価項目 -->
  <div class="sub-section">
    <table class="assessment-table wide">
      <thead>
        <tr>
          <th style="width:40px;">No</th>
          <th>質問項目</th>
          <th>1点</th>
          <th>2点</th>
          <th>3点</th>
          <th>4点</th>
          <th style="width:110px;">分類</th>
          <th style="width:150px;">備考</th>
        </tr>
      </thead>

      <tbody>
        {% for i, question, category in [
          (1, "忘れ物が多いと感じますか", "記憶"),
          (2, "同じことを何度も言うことがありますか", "記憶"),
          (3, "物の置き場所がわからなくなることがありますか", "記憶"),
          (4, "話しかけに反応しないことがありますか", "気分・行動"),
          (5, "怒りっぽくなったり刺激に過敏ですか", "気分・行動"),
          (6, "同じ行動を繰り返すことがありますか", "常同行動"),
          (7, "物を隠したり、盗まれたと訴えることがありますか", "妄想"),
          (8, "うろうろ歩き回ることがありますか", "徘徊"),
          (9, "性的な不適切行動がありますか", "性的行動"),
          (10, "無気力で何もしようとしないですか", "気分・行動"),
          (11, "異常に食べ過ぎたり食行動に問題がありますか", "摂食"),
          (12, "睡眠の問題がありますか", "睡眠"),
          (13, "その他の行動・心理症状がありますか", "その他")
        ] %}
        <tr>
          <td>{{ i }}</td>
          <td>{{ question }}</td>

          <td><input type="radio" name="dbd{{ i }}" value="1" class="score"></td>
          <td><input type="radio" name="dbd{{ i }}" value="2" class="score"></td>
          <td><input type="radio" name="dbd{{ i }}" value="3" class="score"></td>
          <td><input type="radio" name="dbd{{ i }}" value="4" class="score"></td>

          <td>{{ category }}</td>
          <td><textarea></textarea></td>
        </tr>
        {% endfor %}
      </tbody>

    </table>
  </div>

  <!-- 結果 -->
  <div class="sub-section">
    <div class="result-box">
      <strong>評価結果：</strong>
      <span id="dbd_score">--</span> / 52 点
      <p id="dbd_comment" class="muted mt10">まだ評価が実施されていません。</p>
    </div>

    <div class="button-row">
      <button type="button" class="btn primary" onclick="calcDBD()">結果を計算</button>
      <button type="button" class="btn">保存</button>
    </div>
  </div>

</div>

<script>
function calcDBD() {
  let total = 0;

  const checked = document.querySelectorAll('.section input[type="radio"]:checked');
  checked.forEach(r => total += Number(r.value));

  document.getElementById("dbd_score").textContent = total;

  let c = "";
  if (total <= 17) c = "軽度の認知症可能性があります。";
  else if (total <= 35) c = "中等度の認知症状が見られます。";
  else c = "行動・心理症状の増加がみられます。";

  document.getElementById("dbd_comment").textContent = c;
}
</script>
