<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>å¯¾è±¡è€…è©³ç´°ãƒ»ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆ - èªçŸ¥ç—‡åˆæœŸæ”¯æ´æ¥­å‹™ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/common.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/shousai.css') }}">
  <style>
    .detail-header {
        background: linear-gradient(135deg, #3b6ea5 0%, #2c5282 100%);
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .detail-header-left {
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .detail-header-title {
        font-size: 18px;
        font-weight: bold;
        letter-spacing: 0.5px;
    }

    .detail-header-nav {
        display: flex;
        gap: 8px;
    }

    .detail-header-nav a {
        background: rgba(255, 255, 255, 0.15);
        color: white;
        padding: 6px 14px;
        border-radius: 6px;
        text-decoration: none;
        font-size: 13px;
        transition: all 0.2s;
    }

    .detail-header-nav a:hover {
        background: rgba(255, 255, 255, 0.25);
    }

    .detail-header-right {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .client-info-badge {
        background: white;
        color: #333;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 500;
    }

    .client-info-badge span {
        color: #3b6ea5;
        font-weight: 600;
    }

    .header-btn {
        background: white;
        border: none;
        color: #3b6ea5;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .header-btn:hover {
        background: #f0f4f8;
        transform: translateY(-1px);
    }

    .similar-case-btn {
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

    .similar-case-btn:hover {
        background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
    }

    .similar-case-section {
        background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
        border: 2px solid #ddd6fe;
        border-radius: 12px;
        padding: 20px;
        margin: 24px 0;
        text-align: center;
    }

    .similar-case-section h4 {
        color: #6d28d9;
        margin: 0 0 12px 0;
        font-size: 15px;
    }

    .similar-case-section p {
        color: #7c3aed;
        font-size: 13px;
        margin: 0 0 16px 0;
    }

    /* Assessment Sheet Styles - Paper-like Layout */
    .assessment-sheet {
        background: white;
        border: 2px solid #333;
        border-radius: 0;
        margin: 20px 0;
        font-family: "Yu Gothic", "Meiryo", sans-serif;
    }

    .assessment-header {
        background: #f8f9fa;
        border-bottom: 2px solid #333;
        padding: 16px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .assessment-title {
        font-size: 18px;
        font-weight: bold;
        color: #333;
    }

    .assessment-subtitle {
        font-size: 12px;
        color: #666;
        margin-top: 4px;
    }

    .assessment-meta {
        display: flex;
        gap: 20px;
        align-items: center;
    }

    .assessment-meta-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
    }

    .assessment-meta-item label {
        font-weight: 500;
        color: #555;
    }

    .assessment-meta-item input {
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 6px 10px;
        font-size: 13px;
        width: 150px;
    }

    .assessment-body {
        padding: 0;
    }

    .assessment-section {
        border-bottom: 1px solid #ddd;
    }

    .assessment-section:last-child {
        border-bottom: none;
    }

    .assessment-section-header {
        background: #e8f4fc;
        padding: 10px 20px;
        font-weight: bold;
        font-size: 14px;
        color: #2c5282;
        border-bottom: 1px solid #ccc;
    }

    .assessment-table {
        width: 100%;
        border-collapse: collapse;
    }

    .assessment-table th,
    .assessment-table td {
        border: 1px solid #ddd;
        padding: 10px 12px;
        text-align: center;
        font-size: 13px;
    }

    .assessment-table th {
        background: #f5f7fa;
        font-weight: 600;
        color: #333;
    }

    .assessment-table th.item-header {
        text-align: left;
        width: 50%;
    }

    .assessment-table td.item-cell {
        text-align: left;
        padding-left: 16px;
    }

    .assessment-table td.item-cell .item-number {
        display: inline-block;
        width: 24px;
        font-weight: 600;
        color: #3b6ea5;
    }

    .assessment-table input[type="radio"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
    }

    .assessment-footer {
        background: #f8f9fa;
        border-top: 2px solid #333;
        padding: 16px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .assessment-score {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .assessment-score label {
        font-weight: 600;
        font-size: 14px;
        color: #333;
    }

    .assessment-score input {
        width: 80px;
        padding: 8px 12px;
        font-size: 16px;
        font-weight: bold;
        text-align: center;
        border: 2px solid #3b6ea5;
        border-radius: 6px;
        background: #f0f7ff;
        color: #2c5282;
    }

    .assessment-actions {
        display: flex;
        gap: 12px;
    }

    .btn-excel {
        background: linear-gradient(135deg, #217346 0%, #1d6b3f 100%);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.2s;
    }

    .btn-excel:hover {
        background: linear-gradient(135deg, #1d6b3f 0%, #185a34 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(33, 115, 70, 0.3);
    }

    .btn-excel::before {
        content: "ğŸ“Š";
    }

    .btn-save {
        background: linear-gradient(135deg, #3b6ea5 0%, #2c5282 100%);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .btn-save:hover {
        background: linear-gradient(135deg, #2c5282 0%, #234168 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(59, 110, 165, 0.3);
    }

    /* Scale Legend */
    .scale-legend {
        background: #fffbeb;
        border: 1px solid #fcd34d;
        border-radius: 6px;
        padding: 12px 16px;
        margin: 16px 20px;
        font-size: 12px;
        color: #92400e;
    }

    .scale-legend strong {
        color: #78350f;
    }

    /* Form Grid for Assessment Info */
    .assessment-info-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
        padding: 16px 20px;
        border-bottom: 1px solid #ddd;
    }

    .assessment-info-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .assessment-info-item label {
        font-size: 12px;
        font-weight: 500;
        color: #555;
    }

    .assessment-info-item input {
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 8px 10px;
        font-size: 13px;
    }

    /* Remarks Section */
    .assessment-remarks {
        padding: 16px 20px;
        border-top: 1px solid #ddd;
    }

    .assessment-remarks label {
        display: block;
        font-size: 13px;
        font-weight: 500;
        color: #555;
        margin-bottom: 8px;
    }

    .assessment-remarks textarea {
        width: 100%;
        min-height: 80px;
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 10px;
        font-size: 13px;
        resize: vertical;
    }

    /* Info Table for Client/Visit/Physical sheets */
    .info-table {
        width: 100%;
        border-collapse: collapse;
    }

    .info-table th,
    .info-table td {
        border: 1px solid #ddd;
        padding: 10px 12px;
        font-size: 13px;
        vertical-align: middle;
    }

    .info-table th {
        background: #f5f7fa;
        font-weight: 600;
        color: #333;
        text-align: left;
        width: 18%;
        white-space: nowrap;
    }

    .info-table td {
        background: white;
    }

    .info-table input[type="text"],
    .info-table input[type="date"],
    .info-table input[type="datetime-local"],
    .info-table input[type="number"],
    .info-table textarea,
    .info-table select {
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 8px 10px;
        font-size: 13px;
        background: #fafafa;
    }

    .info-table input[type="text"]:focus,
    .info-table input[type="date"]:focus,
    .info-table input[type="datetime-local"]:focus,
    .info-table input[type="number"]:focus,
    .info-table textarea:focus,
    .info-table select:focus {
        outline: none;
        border-color: #3b6ea5;
        background: white;
        box-shadow: 0 0 0 2px rgba(59, 110, 165, 0.1);
    }

    .info-table .full-width {
        width: 100%;
        box-sizing: border-box;
    }

    .info-table textarea {
        resize: vertical;
        min-height: 60px;
    }

    .info-table select {
        min-width: 120px;
    }

    /* Observation section for visit record */
    .observation-section {
        padding: 16px 20px;
    }

    .observation-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
    }

    .observation-item {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .observation-item.full {
        grid-column: 1 / -1;
    }

    .observation-item label {
        font-size: 13px;
        font-weight: 500;
        color: #333;
    }

    .observation-item textarea,
    .observation-item input {
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 8px 10px;
        font-size: 13px;
        background: #fafafa;
    }

    .observation-item textarea:focus,
    .observation-item input:focus {
        outline: none;
        border-color: #3b6ea5;
        background: white;
        box-shadow: 0 0 0 2px rgba(59, 110, 165, 0.1);
    }

    .observation-item textarea {
        resize: vertical;
        min-height: 60px;
    }

    /* Inline score inputs */
    .score-inputs {
        display: flex;
        gap: 16px;
        align-items: center;
        flex-wrap: wrap;
    }

    .score-inputs label {
        font-size: 12px;
        color: #555;
    }

    .score-inputs input {
        width: 80px;
        text-align: center;
    }
  </style>
</head>
<body>

<div class="detail-header">
    <div class="detail-header-left">
        <div class="detail-header-title">èªçŸ¥ç—‡åˆæœŸæ”¯æ´æ¥­å‹™ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </div>
        <div class="detail-header-nav">
            <a href="/top">ãƒˆãƒƒãƒ—</a>
            <a href="/list">å¯¾è±¡è€…ä¸€è¦§</a>
        </div>
    </div>

    <div class="detail-header-right">
        <div class="client-info-badge">ID: <span id="header_client_id">---</span></div>
        <div class="client-info-badge">æ°å: <span id="header_client_name">---</span></div>
        <button class="header-btn" onclick="openFolder()">ãƒ•ã‚©ãƒ«ãƒ€</button>
    </div>
</div>

  <div class="page-wrapper">
    <header class="page-header">
      <h1>èªçŸ¥ç—‡åˆæœŸé›†ä¸­æ”¯æ´ã€€å¯¾è±¡è€…è©³ç´°ãƒ»ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆ</h1>
      <div class="client-info-header">
        <label>åˆ©ç”¨è€…IDï¼ˆclient_idï¼‰ï¼š</label>
        <input type="text" id="global_client_id" class="client-id-input" placeholder="ä¾‹: 1, 2, 3 ..." />
        <button type="button" id="reloadBtn">èª­è¾¼</button>
      </div>
    </header>

    <!-- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ -->
    <nav class="tabs">
      <button class="tab-button active" data-tab="tab-client">â‘  åˆ©ç”¨è€…åŸºæœ¬æƒ…å ±</button>
      <button class="tab-button" data-tab="tab-visit">â‘¡ è¨ªå•è¨˜éŒ²è¡¨</button>
      <button class="tab-button" data-tab="tab-physical">â‘¢ èº«ä½“çŠ¶æ³ãƒã‚§ãƒƒã‚¯è¡¨</button>
      <button class="tab-button" data-tab="tab-dasc">â‘£ DASC-21</button>
      <button class="tab-button" data-tab="tab-dbd">â‘¤ DBD-13</button>
    </nav>

    <main class="tab-contents">

      <!-- â‘  åˆ©ç”¨è€…åŸºæœ¬æƒ…å ±ï¼ˆclientï¼‰ -->
      <section id="tab-client" class="tab-pane active">
        <form id="form-client" class="form-section">
          <input type="hidden" name="client_id" class="client-id-field" />

          <div class="assessment-sheet">
            <div class="assessment-header">
              <div>
                <div class="assessment-title">åˆ©ç”¨è€…åŸºæœ¬æƒ…å ±</div>
                <div class="assessment-subtitle">èªçŸ¥ç—‡åˆæœŸé›†ä¸­æ”¯æ´ãƒãƒ¼ãƒ ã€€å¯¾è±¡è€…æƒ…å ±ã‚·ãƒ¼ãƒˆ</div>
              </div>
            </div>

            <!-- åŸºæœ¬æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="assessment-section">
              <div class="assessment-section-header">åŸºæœ¬æƒ…å ±</div>
              <table class="info-table">
                <tr>
                  <th>ä½œæˆæ‹…å½“è€…</th>
                  <td><input type="text" name="writer_name" class="full-width"></td>
                  <th>ç›¸è«‡æ—¥</th>
                  <td><input type="date" name="consultation_date"></td>
                </tr>
                <tr>
                  <th>æœ¬äººæ°å</th>
                  <td><input type="text" name="client_name" class="full-width"></td>
                  <th>æ€§åˆ¥</th>
                  <td>
                    <select name="gender">
                      <option value="">é¸æŠ</option>
                      <option value="ç”·æ€§">ç”·æ€§</option>
                      <option value="å¥³æ€§">å¥³æ€§</option>
                      <option value="ãã®ä»–">ãã®ä»–</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <th>ç”Ÿå¹´æœˆæ—¥</th>
                  <td><input type="date" name="birth_date"></td>
                  <th>é›»è©±ç•ªå·</th>
                  <td><input type="text" name="phone_number" class="full-width"></td>
                </tr>
                <tr>
                  <th>ä½æ‰€</th>
                  <td colspan="3"><input type="text" name="address" class="full-width"></td>
                </tr>
                <tr>
                  <th>æœ¬äººã®ç¾æ³</th>
                  <td colspan="3"><textarea name="current_status" rows="2" class="full-width"></textarea></td>
                </tr>
              </table>
            </div>

            <!-- è‡ªç«‹åº¦ãƒ»èªå®šæƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="assessment-section">
              <div class="assessment-section-header">è‡ªç«‹åº¦ãƒ»èªå®šæƒ…å ±</div>
              <table class="info-table">
                <tr>
                  <th>éšœå®³é«˜é½¢è€…ã®æ—¥å¸¸ç”Ÿæ´»è‡ªç«‹åº¦</th>
                  <td><input type="text" name="disability_adl_level" placeholder="è‡ªç«‹ / J1 / A1 ..." class="full-width"></td>
                  <th>èªçŸ¥ç—‡é«˜é½¢è€…ã®æ—¥å¸¸ç”Ÿæ´»è‡ªç«‹åº¦</th>
                  <td><input type="text" name="dementia_adl_level" placeholder="è‡ªç«‹ / IIa / IIIa ..." class="full-width"></td>
                </tr>
                <tr>
                  <th>èªå®šãƒ»ç·åˆäº‹æ¥­æƒ…å ±</th>
                  <td colspan="3"><textarea name="certification_info" rows="2" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>éšœå®³ç­‰èªå®š</th>
                  <td colspan="3"><textarea name="disability_certification" rows="2" placeholder="èº«éšœâ—‹ç´šãƒ»ç™‚è‚²â—‹åº¦ ãªã©" class="full-width"></textarea></td>
                </tr>
              </table>
            </div>

            <!-- ç”Ÿæ´»ç’°å¢ƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="assessment-section">
              <div class="assessment-section-header">ç”Ÿæ´»ç’°å¢ƒ</div>
              <table class="info-table">
                <tr>
                  <th>ä½å±…ç’°å¢ƒ</th>
                  <td><textarea name="living_environment" rows="2" placeholder="è‡ªå®… / å€Ÿå®¶ / é›†åˆä½å®… ãªã©" class="full-width"></textarea></td>
                  <th>çµŒæ¸ˆçŠ¶æ³</th>
                  <td><textarea name="economic_status" rows="2" placeholder="å¹´é‡‘ãƒ»ç”Ÿæ´»ä¿è­· ç­‰" class="full-width"></textarea></td>
                </tr>
              </table>
            </div>

            <!-- ç›¸è«‡è€…ãƒ»å®¶æ—æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="assessment-section">
              <div class="assessment-section-header">ç›¸è«‡è€…ãƒ»å®¶æ—æƒ…å ±</div>
              <table class="info-table">
                <tr>
                  <th>æ¥æ‰€è€…ãƒ»ç›¸è«‡è€…æ°å</th>
                  <td><input type="text" name="visitor_name" class="full-width"></td>
                  <th>æœ¬äººã¨ã®ç¶šæŸ„</th>
                  <td><input type="text" name="relation_to_client" class="full-width"></td>
                </tr>
                <tr>
                  <th>æ¥æ‰€è€…é€£çµ¡å…ˆ</th>
                  <td colspan="3"><input type="text" name="visitor_contact" class="full-width"></td>
                </tr>
                <tr>
                  <th>å®¶æ—æ§‹æˆ</th>
                  <td colspan="3"><textarea name="family_composition" rows="2" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>ç·Šæ€¥é€£çµ¡å…ˆæ°å</th>
                  <td><input type="text" name="emergency_contact_name" class="full-width"></td>
                  <th>ç¶šæŸ„</th>
                  <td><input type="text" name="emergency_relation" class="full-width"></td>
                </tr>
                <tr>
                  <th>ç·Šæ€¥é€£çµ¡å…ˆ</th>
                  <td colspan="3"><input type="text" name="emergency_contact_info" class="full-width"></td>
                </tr>
              </table>
            </div>

            <!-- ç”Ÿæ´»æ­´ãƒ»æ—¥å¸¸ç”Ÿæ´»ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="assessment-section">
              <div class="assessment-section-header">ç”Ÿæ´»æ­´ãƒ»æ—¥å¸¸ç”Ÿæ´»</div>
              <table class="info-table">
                <tr>
                  <th>ä»Šã¾ã§ã®ç”Ÿæ´»æ­´</th>
                  <td colspan="3"><textarea name="life_history" rows="3" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>ç¾åœ¨ã®ç”Ÿæ´»çŠ¶æ³ãƒ»1æ—¥ã®éã”ã—æ–¹</th>
                  <td colspan="3"><textarea name="daily_life_pattern" rows="3" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>æ™‚é–“å¸¯</th>
                  <td colspan="3"><input type="text" name="time_of_day" placeholder="ä¾‹ï¼šæ—¥ä¸­ / å¤œé–“ ãªã©" class="full-width"></td>
                </tr>
              </table>
            </div>

            <!-- æœ¬äººãƒ»å®¶æ—ã®æ€ã„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="assessment-section">
              <div class="assessment-section-header">æœ¬äººãƒ»å®¶æ—ã®æ€ã„</div>
              <table class="info-table">
                <tr>
                  <th>æœ¬äººã®æ€ã„ãƒ»æ°—æŒã¡</th>
                  <td colspan="3"><textarea name="person_content" rows="3" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>ä»‹è­·è€…ãƒ»å®¶æ—ã®æ€ã„</th>
                  <td colspan="3"><textarea name="caregiver_content" rows="3" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>è¶£å‘³ãƒ»æ¥½ã—ã¿</th>
                  <td><textarea name="hobbies" rows="2" class="full-width"></textarea></td>
                  <th>å‹äººãƒ»åœ°åŸŸã¨ã®ã¤ãªãŒã‚Š</th>
                  <td><textarea name="social_connections" rows="2" class="full-width"></textarea></td>
                </tr>
              </table>
            </div>

            <!-- ç¾ç—…æ­´ãƒ»æ—¢å¾€æ­´ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="assessment-section">
              <div class="assessment-section-header">ç¾ç—…æ­´ãƒ»æ—¢å¾€æ­´ã¨çµŒé</div>
              <table class="info-table">
                <tr>
                  <th>ç™ºç—‡æ™‚æœŸ</th>
                  <td><input type="date" name="disease_onset_date"></td>
                  <th>ä¸»ãªç–¾æ‚£å</th>
                  <td><input type="text" name="disease_name" class="full-width"></td>
                </tr>
                <tr>
                  <th>ä¸»æ²»åŒ»ãƒ»åŒ»ç™‚æ©Ÿé–¢</th>
                  <td colspan="3"><input type="text" name="medical_institution" class="full-width"></td>
                </tr>
                <tr>
                  <th>æ—¢å¾€æ­´</th>
                  <td colspan="3"><textarea name="medical_history" rows="3" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>ç¾åœ¨ã®çŠ¶æ…‹ãƒ»çµŒé</th>
                  <td colspan="3"><textarea name="current_condition" rows="3" class="full-width"></textarea></td>
                </tr>
              </table>
            </div>

            <!-- åˆ©ç”¨ã‚µãƒ¼ãƒ“ã‚¹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="assessment-section">
              <div class="assessment-section-header">ç¾åœ¨åˆ©ç”¨ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹</div>
              <table class="info-table">
                <tr>
                  <th>å…¬çš„ã‚µãƒ¼ãƒ“ã‚¹</th>
                  <td colspan="3"><textarea name="public_services" rows="3" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>éå…¬çš„ã‚µãƒ¼ãƒ“ã‚¹</th>
                  <td colspan="3"><textarea name="private_services" rows="3" class="full-width"></textarea></td>
                </tr>
              </table>
            </div>

            <div class="assessment-footer">
              <div class="assessment-actions">
                <button type="button" class="btn-excel" onclick="exportClientToExcel()">Excelå‡ºåŠ›</button>
                <button type="button" class="btn-save" onclick="saveClient()">ä¿å­˜</button>
              </div>
            </div>
          </div>
        </form>
      </section>

      <!-- â‘¡ è¨ªå•è¨˜éŒ²è¡¨ï¼ˆvisit_recordï¼‰ -->
      <section id="tab-visit" class="tab-pane">
        <form id="form-visit" class="form-section">
          <input type="hidden" name="client_id" class="client-id-field" />

          <div class="assessment-sheet">
            <div class="assessment-header">
              <div>
                <div class="assessment-title">è¨ªå•è¨˜éŒ²è¡¨</div>
                <div class="assessment-subtitle">èªçŸ¥ç—‡åˆæœŸé›†ä¸­æ”¯æ´ãƒãƒ¼ãƒ ã€€è¨ªå•è¨˜éŒ²</div>
              </div>
            </div>

            <!-- åŸºæœ¬æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="assessment-section">
              <div class="assessment-section-header">è¨ªå•åŸºæœ¬æƒ…å ±</div>
              <table class="info-table">
                <tr>
                  <th>è¨ªå•æ—¥æ™‚</th>
                  <td><input type="datetime-local" name="visit_datetime" class="full-width"></td>
                  <th>è¨ªå•è€…æ°å</th>
                  <td><input type="text" name="visitor_name" class="full-width"></td>
                </tr>
                <tr>
                  <th>è¨ªå•ç›®çš„</th>
                  <td colspan="3"><textarea name="visit_purpose" rows="2" class="full-width"></textarea></td>
                </tr>
              </table>
            </div>

            <!-- è¨ªå•æ™‚ã®è¦³å¯Ÿé …ç›®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="assessment-section">
              <div class="assessment-section-header">è¨ªå•æ™‚ã®è¦³å¯Ÿé …ç›®</div>
              <table class="info-table">
                <tr>
                  <th>è¨ªå•ã«å¯¾ã™ã‚‹æœ¬äººã®åå¿œãƒ»ç†è§£</th>
                  <td colspan="3"><textarea name="vr_reaction" rows="2" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>èªçŸ¥æ©Ÿèƒ½</th>
                  <td><textarea name="vr_cognition" rows="2" class="full-width"></textarea></td>
                  <th>èªçŸ¥ç—‡æ—¥å¸¸ç”Ÿæ´»è‡ªç«‹åº¦</th>
                  <td><input type="text" name="vr_dementia_adl" placeholder="ä¾‹ï¼šIIa / IIIa" class="full-width"></td>
                </tr>
                <tr>
                  <th>ç²¾ç¥ç—‡çŠ¶ãƒ»è¡Œå‹•ç—‡çŠ¶</th>
                  <td colspan="3"><textarea name="vr_behavior" rows="2" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>èº«ä½“çŠ¶æ³</th>
                  <td><textarea name="vr_physical" rows="2" class="full-width"></textarea></td>
                  <th>éšœå®³é«˜é½¢è€…æ—¥å¸¸ç”Ÿæ´»è‡ªç«‹åº¦</th>
                  <td><input type="text" name="vr_disability_adl" placeholder="ä¾‹ï¼šJ1 / A1" class="full-width"></td>
                </tr>
                <tr>
                  <th>ç”Ÿæ´»çŠ¶æ³</th>
                  <td colspan="3"><textarea name="vr_living" rows="2" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆã‚·ãƒ¼ãƒˆåˆè¨ˆ</th>
                  <td colspan="3">
                    <div class="score-inputs">
                      <label>DASC-21ï¼š</label><input type="number" name="vr_dasc">
                      <label>DBD13ï¼š</label><input type="number" name="vr_dbd">
                      <label>J-ZBI_8ï¼š</label><input type="number" name="vr_jzbi">
                    </div>
                  </td>
                </tr>
                <tr>
                  <th>æœ¬äººã®æ„å‘ãƒ»å¸Œæœ›</th>
                  <td colspan="3"><textarea name="vr_person_intent" rows="2" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>ä»‹è­·è€…ã®æ„å‘ãƒ»å¸Œæœ›</th>
                  <td colspan="3"><textarea name="vr_family_intent" rows="2" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>ãã®ä»–</th>
                  <td colspan="3"><textarea name="vr_other" rows="2" class="full-width"></textarea></td>
                </tr>
              </table>
            </div>

            <!-- è¨ªå•æ™‚ã®è©³ç´°è¦³å¯Ÿã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="assessment-section">
              <div class="assessment-section-header">è¨ªå•æ™‚ã®è©³ç´°è¦³å¯Ÿï¼ˆèº«ä½“çŠ¶æ³ãƒã‚§ãƒƒã‚¯è¦ç´„ï¼‰</div>
              <table class="info-table">
                <tr>
                  <th>é‹å‹•æ©Ÿèƒ½ãƒ»ç«‹ã¡ä¸ŠãŒã‚Šãƒ»æ­©è¡ŒçŠ¶æ³</th>
                  <td><textarea name="vr_mobility" rows="2" class="full-width"></textarea></td>
                  <th>ç§»å‹•æ–¹æ³•ãƒ»æ—¥å¸¸çš„ãªç§»å‹•ç¯„å›²</th>
                  <td><textarea name="vr_movement" rows="2" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>æ„æ€ç–é€šã®çŠ¶æ³</th>
                  <td><textarea name="vr_communication" rows="2" class="full-width"></textarea></td>
                  <th>è¦–åŠ›ãƒ»è´åŠ›</th>
                  <td><textarea name="vr_senses" rows="2" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>å…¥æµ´ãƒ»è¡›ç”Ÿãƒ»æ¸…æ½”çŠ¶æ³</th>
                  <td><textarea name="vr_hygiene" rows="2" class="full-width"></textarea></td>
                  <th>æ „é¤ŠçŠ¶æ…‹ãƒ»é£Ÿäº‹çŠ¶æ³</th>
                  <td><textarea name="vr_nutrition" rows="2" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>æ’æ³„çŠ¶æ³ï¼ˆå°¿ãƒ»ä¾¿ãƒ»å¤±ç¦ï¼‰</th>
                  <td><textarea name="vr_excretion" rows="2" class="full-width"></textarea></td>
                  <th>ç¡çœ çŠ¶æ³ï¼ˆç¡çœ è–¬ãƒ»ç”Ÿæ´»ãƒªã‚ºãƒ å«ã‚€ï¼‰</th>
                  <td><textarea name="vr_sleep" rows="2" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>å±…ä½ç’°å¢ƒã®å•é¡Œ</th>
                  <td><textarea name="vr_house" rows="2" class="full-width"></textarea></td>
                  <th>é‡‘éŠ­ç®¡ç†ã®çŠ¶æ³</th>
                  <td><textarea name="vr_money" rows="2" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>å®¶æ—ã®ä»‹è­·åŠ›</th>
                  <td><textarea name="vr_family_care" rows="2" class="full-width"></textarea></td>
                  <th>è™å¾…ã®å¯èƒ½æ€§</th>
                  <td><textarea name="vr_abuse" rows="2" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>è¦‹å®ˆã‚Šã®çŠ¶æ³</th>
                  <td><textarea name="vr_watch" rows="2" class="full-width"></textarea></td>
                  <th>ç·Šæ€¥æ™‚ã®SOSç™ºä¿¡ã®å¯å¦</th>
                  <td><textarea name="vr_sos" rows="2" class="full-width"></textarea></td>
                </tr>
              </table>
            </div>

            <!-- åˆ¤æ–­ãƒ»æ”¯æ´å†…å®¹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="assessment-section">
              <div class="assessment-section-header">åˆ¤æ–­ãƒ»æ”¯æ´å†…å®¹</div>
              <table class="info-table">
                <tr>
                  <th>åˆ¤æ–­ãƒ»æ”¯æ´å†…å®¹</th>
                  <td colspan="3"><textarea name="support_decision" rows="4" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>ä»Šå¾Œã®æ–¹é‡ãƒ»æ”¯æ´è¨ˆç”»</th>
                  <td colspan="3"><textarea name="future_plan" rows="4" class="full-width"></textarea></td>
                </tr>
              </table>
            </div>

            <!-- é¡ä¼¼äº‹ä¾‹æ¤œç´¢ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="similar-case-section">
              <h4>é¡ä¼¼äº‹ä¾‹ã‚’æ¤œç´¢</h4>
              <p>ã“ã®å¯¾è±¡è€…ã®ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆæƒ…å ±ã‚’ã‚‚ã¨ã«ã€é¡ä¼¼ã—ãŸæ”¯æ´äº‹ä¾‹ã‚’æ¤œç´¢ã§ãã¾ã™</p>
              <button type="button" class="similar-case-btn" onclick="openSimilarCases()">
                é¡ä¼¼äº‹ä¾‹ã‚’æ¤œç´¢
              </button>
            </div>

            <div class="assessment-footer">
              <div class="assessment-actions">
                <button type="button" class="btn-excel" onclick="exportVisitToExcel()">Excelå‡ºåŠ›</button>
                <button type="button" class="btn-save" onclick="saveVisit()">ä¿å­˜</button>
              </div>
            </div>
          </div>
        </form>
      </section>

      <!-- â‘¢ èº«ä½“çŠ¶æ³ãƒã‚§ãƒƒã‚¯è¡¨ï¼ˆphysical_statusï¼‰ -->
      <section id="tab-physical" class="tab-pane">
        <form id="form-physical" class="form-section">
          <input type="hidden" name="client_id" class="client-id-field" />

          <div class="assessment-sheet">
            <div class="assessment-header">
              <div>
                <div class="assessment-title">èº«ä½“çŠ¶æ³ãƒã‚§ãƒƒã‚¯è¡¨</div>
                <div class="assessment-subtitle">èªçŸ¥ç—‡åˆæœŸé›†ä¸­æ”¯æ´ãƒãƒ¼ãƒ ã€€èº«ä½“çŠ¶æ³ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆ</div>
              </div>
            </div>

            <!-- é‹å‹•æ©Ÿèƒ½ãƒ»ç§»å‹•ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="assessment-section">
              <div class="assessment-section-header">é‹å‹•æ©Ÿèƒ½ãƒ»ç§»å‹•</div>
              <table class="info-table">
                <tr>
                  <th>ç«‹ã¡ä¸ŠãŒã‚Šãƒ»é‹å‹•æ©Ÿèƒ½</th>
                  <td><textarea name="ps_mobility" rows="2" placeholder="ä¾‹ï¼šæ”¯ãˆãªã—ã§ç«‹ã¦ã‚‹ï¼æ”¯ãˆãŒå¿…è¦ ãªã©" class="full-width"></textarea></td>
                  <th>æ­©è¡ŒçŠ¶æ³ãƒ»æ­©è¡Œãƒ¬ãƒ™ãƒ«</th>
                  <td><textarea name="ps_walking" rows="2" placeholder="å®¤å†…ï¼šè‡ªç«‹/ä»‹åŠ©ã€€å±‹å¤–ï¼šè‡ªç«‹/ä»‹åŠ©" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>ç§»å‹•æ–¹æ³•ãƒ»ç¯„å›²</th>
                  <td colspan="3"><textarea name="ps_transport" rows="2" placeholder="å…¬å…±äº¤é€šæ©Ÿé–¢ï¼ã‚¿ã‚¯ã‚·ãƒ¼ï¼è‡ªå®¶ç”¨è»Šï¼è‡ªè»¢è»Šï¼å¾’æ­©ãªã©" class="full-width"></textarea></td>
                </tr>
              </table>
            </div>

            <!-- ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»èªçŸ¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="assessment-section">
              <div class="assessment-section-header">ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»èªçŸ¥</div>
              <table class="info-table">
                <tr>
                  <th>æ„æ€ç–é€š</th>
                  <td><textarea name="ps_communication" rows="2" placeholder="è¨ªå•è€…ã¨æ„æ€ç–é€šãŒã§ãã‚‹ã‹ã€æŒ‡ç¤ºã®ç†è§£ãªã©" class="full-width"></textarea></td>
                  <th>æ—¥å¸¸ã®æ„æ€æ±ºå®š</th>
                  <td><textarea name="ps_decision" rows="2" placeholder="ã§ãã‚‹ï¼ã‚„ã‚„ã§ãã‚‹ï¼ã§ããªã„ ãªã©" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>è¦–åŠ›ãƒ»è´åŠ›ãƒ»è£œè´å™¨ã®æœ‰ç„¡</th>
                  <td colspan="3"><textarea name="ps_senses" rows="2" placeholder="ç›®ãŒè¦‹ãˆã«ãã„ï¼è€³ãŒèã“ãˆã«ãã„ï¼è£œè´å™¨ã®ä½¿ç”¨ãªã©" class="full-width"></textarea></td>
                </tr>
              </table>
            </div>

            <!-- æ¸…æ½”ãƒ»è¡›ç”Ÿã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="assessment-section">
              <div class="assessment-section-header">æ¸…æ½”ãƒ»è¡›ç”Ÿ</div>
              <table class="info-table">
                <tr>
                  <th>å…¥æµ´ãƒ»æ¸…æ½”ä¿æŒ</th>
                  <td><textarea name="ps_hygiene" rows="2" placeholder="å…¥æµ´é »åº¦ãƒ»ã‚·ãƒ£ãƒ¯ãƒ¼ãƒ»æ¸…æ‹­ãƒ»æ¸…æ½”çŠ¶æ…‹ãªã©" class="full-width"></textarea></td>
                  <th>è¡£é¡ãƒ»å®¶å±‹ã®æ¸…æ½”ã•</th>
                  <td><textarea name="ps_cleanliness" rows="2" class="full-width"></textarea></td>
                </tr>
              </table>
            </div>

            <!-- æ „é¤Šãƒ»é£Ÿäº‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="assessment-section">
              <div class="assessment-section-header">æ „é¤Šãƒ»é£Ÿäº‹</div>
              <table class="info-table">
                <tr>
                  <th>æ „é¤ŠçŠ¶æ…‹ãƒ»ä½“é‡ãƒ»é£Ÿäº‹çŠ¶æ³</th>
                  <td><textarea name="ps_nutrition" rows="2" class="full-width"></textarea></td>
                  <th>éé£Ÿï¼ç•°é£Ÿ</th>
                  <td><textarea name="ps_eating_behavior" rows="2" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>é£Ÿç‰©ã‚’å™›ã‚€ãƒ»é£²ã¿è¾¼ã‚€èƒ½åŠ›</th>
                  <td><textarea name="ps_swallowing" rows="2" class="full-width"></textarea></td>
                  <th>é£Ÿäº‹æ‹’å¦ãƒ»æ™‚é–“</th>
                  <td><textarea name="ps_meal_refusal" rows="2" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>æ°´åˆ†æ‘‚å–çŠ¶æ³</th>
                  <td><textarea name="ps_water" rows="2" class="full-width"></textarea></td>
                  <th>é£²é…’ãƒ»å–«ç…™</th>
                  <td><textarea name="ps_habits" rows="2" class="full-width"></textarea></td>
                </tr>
              </table>
            </div>

            <!-- æ’æ³„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="assessment-section">
              <div class="assessment-section-header">æ’æ³„</div>
              <table class="info-table">
                <tr>
                  <th>æ’å°¿ãƒ»æ’ä¾¿</th>
                  <td><textarea name="ps_excretion" rows="2" class="full-width"></textarea></td>
                  <th>ä¾¿ç§˜ï¼ˆä¸‹å‰¤ã®ä½¿ç”¨ï¼‰</th>
                  <td><textarea name="ps_constipation" rows="2" class="full-width"></textarea></td>
                </tr>
              </table>
            </div>

            <!-- ç¡çœ ãƒ»ç”Ÿæ´»ãƒªã‚ºãƒ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="assessment-section">
              <div class="assessment-section-header">ç¡çœ ãƒ»ç”Ÿæ´»ãƒªã‚ºãƒ </div>
              <table class="info-table">
                <tr>
                  <th>ç¡çœ çŠ¶æ³ï¼ˆç¡çœ è–¬ã®æœ‰ç„¡ï¼‰</th>
                  <td><textarea name="ps_sleep" rows="2" class="full-width"></textarea></td>
                  <th>èµ·åºŠãƒ»å°±å¯æ™‚é–“</th>
                  <td><textarea name="ps_daily_rhythm" rows="2" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>æ—¥ä¸­ã®ç¡çœ </th>
                  <td><textarea name="ps_daytime_sleep" rows="2" class="full-width"></textarea></td>
                  <th>å¤œé–“ã®è¡Œå‹•ï¼ˆå¤§å£°ãƒ»èµ·ãä¸ŠãŒã‚Šï¼‰</th>
                  <td><textarea name="ps_night_behavior" rows="2" class="full-width"></textarea></td>
                </tr>
              </table>
            </div>

            <!-- ç”Ÿæ´»ç’°å¢ƒãƒ»æ”¯æ´ä½“åˆ¶ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="assessment-section">
              <div class="assessment-section-header">ç”Ÿæ´»ç’°å¢ƒãƒ»æ”¯æ´ä½“åˆ¶</div>
              <table class="info-table">
                <tr>
                  <th>å±…ä½ç’°å¢ƒã®å•é¡Œ</th>
                  <td><textarea name="ps_house_env" rows="2" class="full-width"></textarea></td>
                  <th>é‡‘éŠ­ç®¡ç†</th>
                  <td><textarea name="ps_money" rows="2" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>å®¶æ—ã®ä»‹è­·åŠ›</th>
                  <td><textarea name="ps_family_care" rows="2" class="full-width"></textarea></td>
                  <th>è™å¾…ã®å¯èƒ½æ€§</th>
                  <td><textarea name="ps_abuse" rows="2" class="full-width"></textarea></td>
                </tr>
                <tr>
                  <th>è¦‹å®ˆã‚Šã®çŠ¶æ³</th>
                  <td><textarea name="ps_watch" rows="2" class="full-width"></textarea></td>
                  <th>ç·Šæ€¥æ™‚ã®SOSç™ºä¿¡</th>
                  <td><textarea name="ps_sos" rows="2" class="full-width"></textarea></td>
                </tr>
              </table>
            </div>

            <div class="assessment-footer">
              <div class="assessment-actions">
                <button type="button" class="btn-excel" onclick="exportPhysicalToExcel()">Excelå‡ºåŠ›</button>
                <button type="button" class="btn-save" onclick="savePhysical()">ä¿å­˜</button>
              </div>
            </div>
          </div>
        </form>
      </section>


      <!-- â‘£ DASC-21 -->
      <section id="tab-dasc" class="tab-pane">
        <form id="form-dasc" class="form-section">
          <input type="hidden" name="client_id" class="client-id-field" />

          <div class="assessment-sheet">
            <div class="assessment-header">
              <div>
                <div class="assessment-title">DASC-21</div>
                <div class="assessment-subtitle">åœ°åŸŸåŒ…æ‹¬ã‚±ã‚¢ã‚·ã‚¹ãƒ†ãƒ ã«ãŠã‘ã‚‹èªçŸ¥ç—‡ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆã‚·ãƒ¼ãƒˆ</div>
              </div>
            </div>

            <div class="assessment-info-grid">
              <div class="assessment-info-item">
                <label>æƒ…å ±æä¾›è€…æ°å</label>
                <input type="text" name="informant_name" placeholder="ã”å®¶æ—ãƒ»ä»‹è­·è€…ç­‰">
              </div>
              <div class="assessment-info-item">
                <label>è©•ä¾¡è€…æ°å</label>
                <input type="text" name="evaluator_name" placeholder="æ‹…å½“è€…å">
              </div>
              <div class="assessment-info-item">
                <label>è©•ä¾¡æ—¥</label>
                <input type="date" name="evaluation_date">
              </div>
            </div>

            <div class="scale-legend">
              <strong>è©•ä¾¡åŸºæº–ï¼š</strong>
              1ï¼å•é¡Œãªãã§ãã‚‹ã€€2ï¼ã ã„ãŸã„ã§ãã‚‹ã€€3ï¼ã‚ã¾ã‚Šã§ããªã„ã€€4ï¼ã§ããªã„
            </div>

            <div class="assessment-body">
              <!-- A. è¨˜æ†¶ -->
              <div class="assessment-section">
                <div class="assessment-section-header">A. è¨˜æ†¶</div>
                <table class="assessment-table">
                  <thead>
                    <tr>
                      <th class="item-header">è©•ä¾¡é …ç›®</th>
                      <th style="width:10%">1</th>
                      <th style="width:10%">2</th>
                      <th style="width:10%">3</th>
                      <th style="width:10%">4</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="item-cell"><span class="item-number">1.</span> è²¡å¸ƒã‚„éµãªã©ã€ç‰©ã‚’ç½®ã„ãŸå ´æ‰€ãŒã‚ã‹ã‚‰ãªããªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã‹</td>
                      <td><input type="radio" name="q1" value="1"></td>
                      <td><input type="radio" name="q1" value="2"></td>
                      <td><input type="radio" name="q1" value="3"></td>
                      <td><input type="radio" name="q1" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">2.</span> 5åˆ†å‰ã«èã„ãŸè©±ã‚’æ€ã„å‡ºã›ãªã„ã“ã¨ãŒã‚ã‚Šã¾ã™ã‹</td>
                      <td><input type="radio" name="q2" value="1"></td>
                      <td><input type="radio" name="q2" value="2"></td>
                      <td><input type="radio" name="q2" value="3"></td>
                      <td><input type="radio" name="q2" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">3.</span> è‡ªåˆ†ã®ç”Ÿå¹´æœˆæ—¥ãŒã‚ã‹ã‚‰ãªããªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã‹</td>
                      <td><input type="radio" name="q3" value="1"></td>
                      <td><input type="radio" name="q3" value="2"></td>
                      <td><input type="radio" name="q3" value="3"></td>
                      <td><input type="radio" name="q3" value="4"></td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <!-- B. è¦‹å½“è­˜ -->
              <div class="assessment-section">
                <div class="assessment-section-header">B. è¦‹å½“è­˜</div>
                <table class="assessment-table">
                  <thead>
                    <tr>
                      <th class="item-header">è©•ä¾¡é …ç›®</th>
                      <th style="width:10%">1</th>
                      <th style="width:10%">2</th>
                      <th style="width:10%">3</th>
                      <th style="width:10%">4</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="item-cell"><span class="item-number">4.</span> ä»Šæ—¥ãŒä½•æœˆä½•æ—¥ã‹ã‚ã‹ã‚‰ãªã„ã¨ããŒã‚ã‚Šã¾ã™ã‹</td>
                      <td><input type="radio" name="q4" value="1"></td>
                      <td><input type="radio" name="q4" value="2"></td>
                      <td><input type="radio" name="q4" value="3"></td>
                      <td><input type="radio" name="q4" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">5.</span> è‡ªåˆ†ã®ã„ã‚‹å ´æ‰€ãŒã©ã“ã ã‹ã‚ã‹ã‚‰ãªããªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã‹</td>
                      <td><input type="radio" name="q5" value="1"></td>
                      <td><input type="radio" name="q5" value="2"></td>
                      <td><input type="radio" name="q5" value="3"></td>
                      <td><input type="radio" name="q5" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">6.</span> é“ã«è¿·ã£ã¦å®¶ã«å¸°ã£ã¦ã“ã‚‰ã‚Œãªããªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã‹</td>
                      <td><input type="radio" name="q6" value="1"></td>
                      <td><input type="radio" name="q6" value="2"></td>
                      <td><input type="radio" name="q6" value="3"></td>
                      <td><input type="radio" name="q6" value="4"></td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <!-- C. å•é¡Œè§£æ±ºãƒ»åˆ¤æ–­åŠ› -->
              <div class="assessment-section">
                <div class="assessment-section-header">C. å•é¡Œè§£æ±ºãƒ»åˆ¤æ–­åŠ›</div>
                <table class="assessment-table">
                  <thead>
                    <tr>
                      <th class="item-header">è©•ä¾¡é …ç›®</th>
                      <th style="width:10%">1</th>
                      <th style="width:10%">2</th>
                      <th style="width:10%">3</th>
                      <th style="width:10%">4</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="item-cell"><span class="item-number">7.</span> é›»æ°—ã‚„ã‚¬ã‚¹ã‚„æ°´é“ãŒæ­¢ã¾ã£ã¦ã—ã¾ã£ãŸã¨ãã«ã€è‡ªåˆ†ã§é©åˆ‡ã«å¯¾å‡¦ã§ãã¾ã™ã‹</td>
                      <td><input type="radio" name="q7" value="1"></td>
                      <td><input type="radio" name="q7" value="2"></td>
                      <td><input type="radio" name="q7" value="3"></td>
                      <td><input type="radio" name="q7" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">8.</span> ä¸€æ—¥ã®è¨ˆç”»ã‚’è‡ªåˆ†ã§ç«‹ã¦ã‚‹ã“ã¨ãŒã§ãã¾ã™ã‹</td>
                      <td><input type="radio" name="q8" value="1"></td>
                      <td><input type="radio" name="q8" value="2"></td>
                      <td><input type="radio" name="q8" value="3"></td>
                      <td><input type="radio" name="q8" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">9.</span> å­£ç¯€ã‚„çŠ¶æ³ã«åˆã£ãŸæœã‚’è‡ªåˆ†ã§é¸ã¶ã“ã¨ãŒã§ãã¾ã™ã‹</td>
                      <td><input type="radio" name="q9" value="1"></td>
                      <td><input type="radio" name="q9" value="2"></td>
                      <td><input type="radio" name="q9" value="3"></td>
                      <td><input type="radio" name="q9" value="4"></td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <!-- D. å®¶åº­å¤–ã®IADL -->
              <div class="assessment-section">
                <div class="assessment-section-header">D. å®¶åº­å¤–ã®IADLï¼ˆæ‰‹æ®µçš„æ—¥å¸¸ç”Ÿæ´»å‹•ä½œï¼‰</div>
                <table class="assessment-table">
                  <thead>
                    <tr>
                      <th class="item-header">è©•ä¾¡é …ç›®</th>
                      <th style="width:10%">1</th>
                      <th style="width:10%">2</th>
                      <th style="width:10%">3</th>
                      <th style="width:10%">4</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="item-cell"><span class="item-number">10.</span> ãƒã‚¹ã‚„é›»è»Šã€è‡ªå®¶ç”¨è»Šãªã©ã‚’ä½¿ã£ã¦ä¸€äººã§å¤–å‡ºã§ãã¾ã™ã‹</td>
                      <td><input type="radio" name="q10" value="1"></td>
                      <td><input type="radio" name="q10" value="2"></td>
                      <td><input type="radio" name="q10" value="3"></td>
                      <td><input type="radio" name="q10" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">11.</span> è²¯é‡‘ã®å‡ºã—å…¥ã‚Œã‚„ã€å®¶è³ƒã‚„å…¬å…±æ–™é‡‘ã®æ”¯æ‰•ã„ã¯ä¸€äººã§ã§ãã¾ã™ã‹</td>
                      <td><input type="radio" name="q11" value="1"></td>
                      <td><input type="radio" name="q11" value="2"></td>
                      <td><input type="radio" name="q11" value="3"></td>
                      <td><input type="radio" name="q11" value="4"></td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <!-- E. å®¶åº­å†…ã®IADL -->
              <div class="assessment-section">
                <div class="assessment-section-header">E. å®¶åº­å†…ã®IADLï¼ˆæ‰‹æ®µçš„æ—¥å¸¸ç”Ÿæ´»å‹•ä½œï¼‰</div>
                <table class="assessment-table">
                  <thead>
                    <tr>
                      <th class="item-header">è©•ä¾¡é …ç›®</th>
                      <th style="width:10%">1</th>
                      <th style="width:10%">2</th>
                      <th style="width:10%">3</th>
                      <th style="width:10%">4</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="item-cell"><span class="item-number">12.</span> è–¬ã‚’æ±ºã¾ã£ãŸæ™‚é–“ã«æ±ºã¾ã£ãŸåˆ†é‡ã®ã‚€ã“ã¨ã¯ã§ãã¾ã™ã‹</td>
                      <td><input type="radio" name="q12" value="1"></td>
                      <td><input type="radio" name="q12" value="2"></td>
                      <td><input type="radio" name="q12" value="3"></td>
                      <td><input type="radio" name="q12" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">13.</span> é›»è©±ã‚’ã‹ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã‹</td>
                      <td><input type="radio" name="q13" value="1"></td>
                      <td><input type="radio" name="q13" value="2"></td>
                      <td><input type="radio" name="q13" value="3"></td>
                      <td><input type="radio" name="q13" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">14.</span> è‡ªåˆ†ã§é£Ÿäº‹ã®æº–å‚™ã¯ã§ãã¾ã™ã‹</td>
                      <td><input type="radio" name="q14" value="1"></td>
                      <td><input type="radio" name="q14" value="2"></td>
                      <td><input type="radio" name="q14" value="3"></td>
                      <td><input type="radio" name="q14" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">15.</span> è‡ªåˆ†ã§ã€æƒé™¤æ©Ÿã‚„ã»ã†ãã‚’ä½¿ã£ã¦æƒé™¤ãŒã§ãã¾ã™ã‹</td>
                      <td><input type="radio" name="q15" value="1"></td>
                      <td><input type="radio" name="q15" value="2"></td>
                      <td><input type="radio" name="q15" value="3"></td>
                      <td><input type="radio" name="q15" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">16.</span> è‡ªåˆ†ã§æ´—æ¿¯ãŒã§ãã¾ã™ã‹</td>
                      <td><input type="radio" name="q16" value="1"></td>
                      <td><input type="radio" name="q16" value="2"></td>
                      <td><input type="radio" name="q16" value="3"></td>
                      <td><input type="radio" name="q16" value="4"></td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <!-- F. èº«ä½“çš„ADL -->
              <div class="assessment-section">
                <div class="assessment-section-header">F. èº«ä½“çš„ADLï¼ˆåŸºæœ¬çš„æ—¥å¸¸ç”Ÿæ´»å‹•ä½œï¼‰</div>
                <table class="assessment-table">
                  <thead>
                    <tr>
                      <th class="item-header">è©•ä¾¡é …ç›®</th>
                      <th style="width:10%">1</th>
                      <th style="width:10%">2</th>
                      <th style="width:10%">3</th>
                      <th style="width:10%">4</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="item-cell"><span class="item-number">17.</span> è‡ªåˆ†ã§é©åˆ‡ãªé‡ã®é£Ÿäº‹ã‚’ã¨ã‚‹ã“ã¨ã¯ã§ãã¾ã™ã‹</td>
                      <td><input type="radio" name="q17" value="1"></td>
                      <td><input type="radio" name="q17" value="2"></td>
                      <td><input type="radio" name="q17" value="3"></td>
                      <td><input type="radio" name="q17" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">18.</span> å…¥æµ´ã¯ä¸€äººã§ã§ãã¾ã™ã‹</td>
                      <td><input type="radio" name="q18" value="1"></td>
                      <td><input type="radio" name="q18" value="2"></td>
                      <td><input type="radio" name="q18" value="3"></td>
                      <td><input type="radio" name="q18" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">19.</span> ãƒˆã‚¤ãƒ¬ã¯ä¸€äººã§ã§ãã¾ã™ã‹</td>
                      <td><input type="radio" name="q19" value="1"></td>
                      <td><input type="radio" name="q19" value="2"></td>
                      <td><input type="radio" name="q19" value="3"></td>
                      <td><input type="radio" name="q19" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">20.</span> èº«ã ã—ãªã¿ã‚’æ•´ãˆã‚‹ã“ã¨ã¯ä¸€äººã§ã§ãã¾ã™ã‹</td>
                      <td><input type="radio" name="q20" value="1"></td>
                      <td><input type="radio" name="q20" value="2"></td>
                      <td><input type="radio" name="q20" value="3"></td>
                      <td><input type="radio" name="q20" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">21.</span> ä¸€äººã§å¤–å‡ºã§ãã¾ã™ã‹</td>
                      <td><input type="radio" name="q21" value="1"></td>
                      <td><input type="radio" name="q21" value="2"></td>
                      <td><input type="radio" name="q21" value="3"></td>
                      <td><input type="radio" name="q21" value="4"></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="assessment-remarks">
              <label>å‚™è€ƒ</label>
              <textarea name="remarks" placeholder="ç‰¹è¨˜äº‹é …ãŒã‚ã‚Œã°è¨˜å…¥ã—ã¦ãã ã•ã„"></textarea>
            </div>

            <div class="assessment-footer">
              <div class="assessment-score">
                <label>åˆè¨ˆç‚¹</label>
                <input type="number" name="total_score" id="dasc-total" readonly>
                <span style="font-size: 12px; color: #666;">ï¼ˆ21ã€œ84ç‚¹ã€31ç‚¹ä»¥ä¸Šã§èªçŸ¥ç—‡ã®ç–‘ã„ï¼‰</span>
              </div>
              <div class="assessment-actions">
                <button type="button" class="btn-excel" onclick="exportDascToExcel()">Excelå‡ºåŠ›</button>
                <button type="button" class="btn-save" onclick="saveDasc()">ä¿å­˜</button>
              </div>
            </div>
          </div>
        </form>
      </section>

      <!-- â‘¤ DBD-13 -->
      <section id="tab-dbd" class="tab-pane">
        <form id="form-dbd" class="form-section">
          <input type="hidden" name="client_id" class="client-id-field" />

          <div class="assessment-sheet">
            <div class="assessment-header">
              <div>
                <div class="assessment-title">DBD-13</div>
                <div class="assessment-subtitle">èªçŸ¥ç—‡è¡Œå‹•éšœå®³å°ºåº¦ï¼ˆDementia Behavior Disturbance Scaleï¼‰çŸ­ç¸®ç‰ˆ</div>
              </div>
            </div>

            <div class="assessment-info-grid">
              <div class="assessment-info-item">
                <label>å›ç­”è€…æ°å</label>
                <input type="text" name="respondent_name" placeholder="ã”å®¶æ—ãƒ»ä»‹è­·è€…ç­‰">
              </div>
              <div class="assessment-info-item">
                <label>è©•ä¾¡è€…æ°å</label>
                <input type="text" name="evaluator_name" placeholder="æ‹…å½“è€…å">
              </div>
              <div class="assessment-info-item">
                <label>è¨˜å…¥æ—¥</label>
                <input type="date" name="entry_date">
              </div>
            </div>

            <div class="scale-legend">
              <strong>è©•ä¾¡åŸºæº–ï¼š</strong>
              0ï¼å…¨ããªã„ã€€1ï¼ã»ã¨ã‚“ã©ãªã„ã€€2ï¼ã¨ãã©ãã‚ã‚‹ã€€3ï¼ã‚ˆãã‚ã‚‹ã€€4ï¼å¸¸ã«ã‚ã‚‹
            </div>

            <div class="assessment-body">
              <div class="assessment-section">
                <div class="assessment-section-header">è¡Œå‹•ãƒ»å¿ƒç†ç—‡çŠ¶ï¼ˆBPSDï¼‰è©•ä¾¡é …ç›®</div>
                <table class="assessment-table">
                  <thead>
                    <tr>
                      <th class="item-header">è©•ä¾¡é …ç›®</th>
                      <th style="width:8%">0</th>
                      <th style="width:8%">1</th>
                      <th style="width:8%">2</th>
                      <th style="width:8%">3</th>
                      <th style="width:8%">4</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="item-cell"><span class="item-number">1.</span> åŒã˜ã“ã¨ã‚’ä½•åº¦ã‚‚ä½•åº¦ã‚‚èã</td>
                      <td><input type="radio" name="d1" value="0"></td>
                      <td><input type="radio" name="d1" value="1"></td>
                      <td><input type="radio" name="d1" value="2"></td>
                      <td><input type="radio" name="d1" value="3"></td>
                      <td><input type="radio" name="d1" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">2.</span> ã‚ˆãç‰©ã‚’ãªãã—ãŸã‚Šã€ç½®ãå ´æ‰€ã‚’é–“é•ãˆãŸã‚Šã€éš ã—ãŸã‚Šã—ã¦ã„ã‚‹</td>
                      <td><input type="radio" name="d2" value="0"></td>
                      <td><input type="radio" name="d2" value="1"></td>
                      <td><input type="radio" name="d2" value="2"></td>
                      <td><input type="radio" name="d2" value="3"></td>
                      <td><input type="radio" name="d2" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">3.</span> æ—¥å¸¸çš„ãªç‰©äº‹ã«é–¢å¿ƒã‚’ç¤ºã•ãªã„</td>
                      <td><input type="radio" name="d3" value="0"></td>
                      <td><input type="radio" name="d3" value="1"></td>
                      <td><input type="radio" name="d3" value="2"></td>
                      <td><input type="radio" name="d3" value="3"></td>
                      <td><input type="radio" name="d3" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">4.</span> å¤œä¸­ã«èµ·ãå‡ºã™</td>
                      <td><input type="radio" name="d4" value="0"></td>
                      <td><input type="radio" name="d4" value="1"></td>
                      <td><input type="radio" name="d4" value="2"></td>
                      <td><input type="radio" name="d4" value="3"></td>
                      <td><input type="radio" name="d4" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">5.</span> æ ¹æ‹ ã®ãªã„äº‹ã‚’è¨€ã†ï¼ˆä¾‹ï¼šç›—ã¾ã‚ŒãŸã€é…å¶è€…ãŒæµ®æ°—ã—ã¦ã„ã‚‹ç­‰ï¼‰</td>
                      <td><input type="radio" name="d5" value="0"></td>
                      <td><input type="radio" name="d5" value="1"></td>
                      <td><input type="radio" name="d5" value="2"></td>
                      <td><input type="radio" name="d5" value="3"></td>
                      <td><input type="radio" name="d5" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">6.</span> æ˜¼é–“ã€å¯ã¦ã°ã‹ã‚Šã„ã‚‹</td>
                      <td><input type="radio" name="d6" value="0"></td>
                      <td><input type="radio" name="d6" value="1"></td>
                      <td><input type="radio" name="d6" value="2"></td>
                      <td><input type="radio" name="d6" value="3"></td>
                      <td><input type="radio" name="d6" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">7.</span> ã‚„ãŸã‚‰ã«æ­©ãå›ã‚‹</td>
                      <td><input type="radio" name="d7" value="0"></td>
                      <td><input type="radio" name="d7" value="1"></td>
                      <td><input type="radio" name="d7" value="2"></td>
                      <td><input type="radio" name="d7" value="3"></td>
                      <td><input type="radio" name="d7" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">8.</span> åŒã˜å‹•ä½œã‚’ã„ã¤ã¾ã§ã‚‚ç¹°ã‚Šè¿”ã™</td>
                      <td><input type="radio" name="d8" value="0"></td>
                      <td><input type="radio" name="d8" value="1"></td>
                      <td><input type="radio" name="d8" value="2"></td>
                      <td><input type="radio" name="d8" value="3"></td>
                      <td><input type="radio" name="d8" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">9.</span> å£æ±šãã®ã®ã—ã‚‹</td>
                      <td><input type="radio" name="d9" value="0"></td>
                      <td><input type="radio" name="d9" value="1"></td>
                      <td><input type="radio" name="d9" value="2"></td>
                      <td><input type="radio" name="d9" value="3"></td>
                      <td><input type="radio" name="d9" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">10.</span> å ´é•ã„ã‚ã‚‹ã„ã¯å­£ç¯€ã«åˆã‚ãªã„ä¸é©åˆ‡ãªæœè£…ã‚’ã™ã‚‹</td>
                      <td><input type="radio" name="d10" value="0"></td>
                      <td><input type="radio" name="d10" value="1"></td>
                      <td><input type="radio" name="d10" value="2"></td>
                      <td><input type="radio" name="d10" value="3"></td>
                      <td><input type="radio" name="d10" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">11.</span> ä¸–è©±ã‚’ã•ã‚Œã‚‹ã®ã‚’æ‹’å¦ã™ã‚‹</td>
                      <td><input type="radio" name="d11" value="0"></td>
                      <td><input type="radio" name="d11" value="1"></td>
                      <td><input type="radio" name="d11" value="2"></td>
                      <td><input type="radio" name="d11" value="3"></td>
                      <td><input type="radio" name="d11" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">12.</span> é£Ÿã¹ã‚‰ã‚Œãªã„ã‚‚ã®ã‚’å£ã«å…¥ã‚Œã‚‹</td>
                      <td><input type="radio" name="d12" value="0"></td>
                      <td><input type="radio" name="d12" value="1"></td>
                      <td><input type="radio" name="d12" value="2"></td>
                      <td><input type="radio" name="d12" value="3"></td>
                      <td><input type="radio" name="d12" value="4"></td>
                    </tr>
                    <tr>
                      <td class="item-cell"><span class="item-number">13.</span> å¼•ãå‡ºã—ã‚„ã‚¿ãƒ³ã‚¹ã®ä¸­èº«ã‚’å…¨éƒ¨å‡ºã—ã¦ã—ã¾ã†</td>
                      <td><input type="radio" name="d13" value="0"></td>
                      <td><input type="radio" name="d13" value="1"></td>
                      <td><input type="radio" name="d13" value="2"></td>
                      <td><input type="radio" name="d13" value="3"></td>
                      <td><input type="radio" name="d13" value="4"></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="assessment-footer">
              <div class="assessment-score">
                <label>åˆè¨ˆç‚¹</label>
                <input type="number" name="total_score" id="dbd_total" readonly>
                <span style="font-size: 12px; color: #666;">ï¼ˆ0ã€œ52ç‚¹ã€ç‚¹æ•°ãŒé«˜ã„ã»ã©è¡Œå‹•éšœå®³ãŒé‡ã„ï¼‰</span>
              </div>
              <div class="assessment-actions">
                <button type="button" class="btn-excel" onclick="exportDbdToExcel()">Excelå‡ºåŠ›</button>
                <button type="button" class="btn-save" onclick="saveDbd()">ä¿å­˜</button>
              </div>
            </div>
          </div>
        </form>
      </section>
    </main>
  </div>

  <script>
    // URL ã‹ã‚‰ client_id å–å¾—
    const urlParams = new URLSearchParams(window.location.search);
    const client_id = urlParams.get("client_id");

    // ç”»é¢ä¸Šéƒ¨ã® ID ã‚’ã‚»ãƒƒãƒˆ
    document.getElementById("header_client_id").textContent = client_id ?? "---";

    // DB ã‹ã‚‰æ°åã‚’å–å¾—ã—ã¦è¡¨ç¤º
    fetch(`/api/get_all_data?client_id=${client_id}`)
        .then(res => res.json())
        .then(data => {
            if (data.client) {
                document.getElementById("header_client_name").textContent =
                    data.client.client_name ?? "---";
            }
        });

    // ãƒ•ã‚©ãƒ«ãƒ€ãƒœã‚¿ãƒ³
    function openFolder() {
        window.location.href = `/folder?client_id=${client_id}`;
    }

    // é¡ä¼¼äº‹ä¾‹æ¤œç´¢ãƒœã‚¿ãƒ³
    function openSimilarCases() {
        const cid = document.getElementById("global_client_id").value.trim();
        if (cid) {
            window.location.href = `/text?client_id=${cid}`;
        } else {
            window.location.href = '/text';
        }
    }

    // -----------------------------
    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
    // -----------------------------
    document.querySelectorAll(".tab-button").forEach(btn => {
      btn.addEventListener("click", () => {
        const target = btn.dataset.tab;
        document.querySelectorAll(".tab-button").forEach(b => b.classList.remove("active"));
        document.querySelectorAll(".tab-pane").forEach(p => p.classList.remove("active"));

        btn.classList.add("active");
        document.getElementById(target).classList.add("active");

        // ã‚¿ãƒ–çŠ¶æ…‹ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜
        localStorage.setItem("shousai_active_tab", target);
      });
    });

    // -----------------------------
    // URL ã‹ã‚‰ client_id ã‚’å–å¾—
    // -----------------------------
    function getClientIdFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get("client_id") || "";
    }

    // -----------------------------
    // client_id ã®åŒæœŸ
    // -----------------------------
    function syncClientIdFields(cid) {
      document.getElementById("global_client_id").value = cid;
      document.querySelectorAll(".client-id-field").forEach(el => {
        el.value = cid;
      });
    }

    // -----------------------------
    // ãƒ•ã‚©ãƒ¼ãƒ  â†’ JSON å¤‰æ›
    // -----------------------------
    function formToJSON(form) {
      const fd = new FormData(form);
      const obj = {};
      fd.forEach((value, key) => {
        if (key in obj) {
          if (!Array.isArray(obj[key])) {
            obj[key] = [obj[key]];
          }
          obj[key].push(value);
        } else {
          obj[key] = value;
        }
      });
      return obj;
    }

    // -----------------------------
    // JSON â†’ ãƒ•ã‚©ãƒ¼ãƒ ã¸åæ˜ 
    // -----------------------------
    function fillForm(formId, record) {
      if (!record) return;
      const form = document.getElementById(formId);
      if (!form) return;

      Object.keys(record).forEach(key => {
        const field = form.elements.namedItem(key);
        if (!field) return;

        if (field.type === "checkbox" || field.type === "radio") {
          // ä»Šå›ã¯ text/textarea/numberä¸­å¿ƒãªã®ã§ç°¡æ˜“å¯¾å¿œ
          field.checked = !!record[key];
        } else {
          field.value = record[key] == null ? "" : record[key];
        }
      });
    }

    // -----------------------------
    // å…±é€š POST é–¢æ•°
    // -----------------------------
    async function postJSON(url, data) {
      const res = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
      const json = await res.json();
      if (!res.ok || json.status !== "saved") {
        console.error(json);
        alert("ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼š" + (json.message || res.statusText));
        return;
      }
      alert("ä¿å­˜ã—ã¾ã—ãŸ");
    }

    // =============================
    // ä¿å­˜ãƒœã‚¿ãƒ³ï¼šå„ãƒ•ã‚©ãƒ¼ãƒ 
    // =============================
    function saveClient() {
      const cid = document.getElementById("global_client_id").value.trim();
      if (!cid) {
        alert("å…ˆã« åˆ©ç”¨è€…IDï¼ˆclient_idï¼‰ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      syncClientIdFields(cid);
      const data = formToJSON(document.getElementById("form-client"));
      postJSON("/api/save_client", data);
    }

    function saveVisit() {
      const cid = document.getElementById("global_client_id").value.trim();
      if (!cid) {
        alert("å…ˆã« åˆ©ç”¨è€…IDï¼ˆclient_idï¼‰ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      syncClientIdFields(cid);
      const data = formToJSON(document.getElementById("form-visit"));
      postJSON("/api/save_visit_record", data);
    }

    function savePhysical() {
      const cid = document.getElementById("global_client_id").value.trim();
      if (!cid) {
        alert("å…ˆã« åˆ©ç”¨è€…IDï¼ˆclient_idï¼‰ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      syncClientIdFields(cid);
      const data = formToJSON(document.getElementById("form-physical"));
      postJSON("/api/save_physical_status", data);
    }

    function saveDasc() {
      const cid = document.getElementById("global_client_id").value.trim();
      if (!cid) {
        alert("å…ˆã« åˆ©ç”¨è€…IDï¼ˆclient_idï¼‰ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      syncClientIdFields(cid);
      const data = formToJSON(document.getElementById("form-dasc"));
      postJSON("/api/save_dasc21", data);
    }

    function saveDbd() {
      const cid = document.getElementById("global_client_id").value.trim();
      if (!cid) {
        alert("å…ˆã« åˆ©ç”¨è€…IDï¼ˆclient_idï¼‰ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      syncClientIdFields(cid);
      const data = formToJSON(document.getElementById("form-dbd"));
      postJSON("/api/save_dbd13", data);
    }

    // =============================
    // Excelå‡ºåŠ›ãƒœã‚¿ãƒ³ï¼šå„ãƒ•ã‚©ãƒ¼ãƒ 
    // =============================
    function exportClientToExcel() {
      const cid = document.getElementById("global_client_id").value.trim();
      if (!cid) {
        alert("å…ˆã« åˆ©ç”¨è€…IDï¼ˆclient_idï¼‰ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      window.location.href = `/api/export_client?client_id=${encodeURIComponent(cid)}`;
    }

    function exportVisitToExcel() {
      const cid = document.getElementById("global_client_id").value.trim();
      if (!cid) {
        alert("å…ˆã« åˆ©ç”¨è€…IDï¼ˆclient_idï¼‰ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      window.location.href = `/api/export_visit?client_id=${encodeURIComponent(cid)}`;
    }

    function exportPhysicalToExcel() {
      const cid = document.getElementById("global_client_id").value.trim();
      if (!cid) {
        alert("å…ˆã« åˆ©ç”¨è€…IDï¼ˆclient_idï¼‰ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      window.location.href = `/api/export_physical?client_id=${encodeURIComponent(cid)}`;
    }

    function exportDascToExcel() {
      const cid = document.getElementById("global_client_id").value.trim();
      if (!cid) {
        alert("å…ˆã« åˆ©ç”¨è€…IDï¼ˆclient_idï¼‰ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      window.location.href = `/api/export_dasc21?client_id=${encodeURIComponent(cid)}`;
    }

    function exportDbdToExcel() {
      const cid = document.getElementById("global_client_id").value.trim();
      if (!cid) {
        alert("å…ˆã« åˆ©ç”¨è€…IDï¼ˆclient_idï¼‰ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      window.location.href = `/api/export_dbd13?client_id=${encodeURIComponent(cid)}`;
    }

    // -----------------------------
    // DASC-21ï¼šåˆè¨ˆç‚¹ã®è‡ªå‹•è¨ˆç®—
    // -----------------------------
    function calcDascTotal() {
      let total = 0;
      for (let i = 1; i <= 21; i++) {
        const selected = document.querySelector(`input[name="q${i}"]:checked`);
        if (selected) {
          total += parseInt(selected.value);
        }
      }
      document.getElementById("dasc_total").value = total;
    }

    // -----------------------------
    // DBD-13 åˆè¨ˆè¨ˆç®—
    // -----------------------------
    function calcDbdTotal() {
      let subtotal = 0;

      for (let i = 1; i <= 13; i++) {
        const checked = document.querySelector(`input[name="d${i}"]:checked`);
        if (checked) subtotal += parseInt(checked.value);
      }

      document.getElementById("dbd_subtotal").value = subtotal;
      document.getElementById("dbd_total").value = subtotal; // ä»Šå›ã¯ subtotalï¼total
    }

    // ãƒ©ã‚¸ã‚ªå¤‰æ›´æ™‚ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨ˆç®—
    for (let i = 1; i <= 13; i++) {
      document.querySelectorAll(`input[name="d${i}"]`).forEach(radio => {
        radio.addEventListener("change", calcDbdTotal);
      });
    }

    // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³å¤‰æ›´æ™‚ã«åˆè¨ˆæ›´æ–°
    for (let i = 1; i <= 21; i++) {
      document.querySelectorAll(`input[name="q${i}"]`).forEach(r => {
        r.addEventListener("change", calcDascTotal);
      });
    }

    // -----------------------------
    // å…¨ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    // -----------------------------
    async function loadAllData() {
      const cid = document.getElementById("global_client_id").value.trim();
      if (!cid) return;

      syncClientIdFields(cid);

      try {
        const res = await fetch(`/api/get_all_data?client_id=${encodeURIComponent(cid)}`);
        const json = await res.json();
        if (json.status !== "ok") {
          console.warn(json);
          return;
        }
        fillForm("form-client", json.client);
        fillForm("form-visit", json.visit_record);
        if (json.physical_status) {
          fillForm("form-physical", json.physical_status);
        }
        fillForm("form-dasc", json.dasc21);
        fillForm("form-dbd", json.dbd13);
      } catch (e) {
        console.error(e);
      }
    }
      async function loadFiles() {
        const cid = document.getElementById("global_client_id").value.trim();
        if (!cid) return;

        const res = await fetch(`/api/files?client_id=${cid}`);
        const json = await res.json();

        const box = document.getElementById("file_list");
        box.innerHTML = "";

        json.files.forEach(f => {
          const url = `/uploads/${f.file_path}`;
          box.innerHTML += `
            <div class="file-item">
              <a href="${url}" download>${f.file_path.split("/").pop()}</a>
              ï¼ˆ${f.uploaded_at}ï¼‰
              <button onclick="deleteFile(${f.folder_id})">å‰Šé™¤</button>
            </div>
          `;
        });
      }

    // -----------------------------
    // åˆæœŸè¨­å®š
    // -----------------------------
    document.addEventListener("DOMContentLoaded", () => {
      // URLã‹ã‚‰ client_id
      const cid = getClientIdFromUrl();
      if (cid) {
        syncClientIdFields(cid);
      }

      // å‰å›ã®ã‚¿ãƒ–å¾©å…ƒ
      const savedTab = localStorage.getItem("shousai_active_tab");
      if (savedTab && document.getElementById(savedTab)) {
        document.querySelectorAll(".tab-button").forEach(b => {
          b.classList.toggle("active", b.dataset.tab === savedTab);
        });
        document.querySelectorAll(".tab-pane").forEach(p => {
          p.classList.toggle("active", p.id === savedTab);
        });
      }

      // åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
      loadAllData();

      // ã€Œèª­è¾¼ã€ãƒœã‚¿ãƒ³ã§å†èª­è¾¼
      document.getElementById("reloadBtn").addEventListener("click", loadAllData);
      document.getElementById("reloadBtn").addEventListener("click", () => {
        loadAllData();
        loadFiles();
      });

    });
    //----------------------------------------
    // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
    //----------------------------------------
    function openFolder() {
      const cid = document.getElementById("global_client_id").value.trim();
      if (!cid) {
        alert("å…ˆã«åˆ©ç”¨è€…IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      document.getElementById("fileModal").style.display = "flex";

      loadFileList(cid);
    }

    function closeFileModal() {
      document.getElementById("fileModal").style.display = "none";
    }


    //----------------------------------------
    // ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§å–å¾—
    //----------------------------------------
    async function loadFileList(client_id) {
      const res = await fetch(`/api/shared_files?client_id=${client_id}`);
      const json = await res.json();

      const list = document.getElementById("fileList");
      list.innerHTML = "";

      json.files.forEach(f => {
        const li = document.createElement("li");
        li.innerHTML = `
          ${f.file_name}
          <button onclick="downloadFile(${f.folder_id})">DL</button>
          <button onclick="deleteFile(${f.folder_id})">å‰Šé™¤</button>
        `;
        list.appendChild(li);
      });
    }


    //----------------------------------------
    // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
    //----------------------------------------
    async function uploadFile() {
      const cid = document.getElementById("global_client_id").value.trim();
      const fileInput = document.getElementById("uploadFileInput");

      if (!fileInput.files.length) {
        alert("ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„");
        return;
      }

      const formData = new FormData();
      formData.append("file", fileInput.files[0]);
      formData.append("client_id", cid);

      const res = await fetch("/api/upload_shared_file", {
        method: "POST",
        body: formData
      });

      const json = await res.json();
      if (json.status === "ok") {
        alert("ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ");
        loadFileList(cid);
        fileInput.value = "";
      } else {
        alert("ã‚¨ãƒ©ãƒ¼: " + json.message);
      }
    }

  </script>
</body>
<!-- å…±æœ‰ãƒ•ã‚¡ã‚¤ãƒ« ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="fileModal" class="modal-overlay">
  <div class="modal-window">
    <div class="modal-header">
      <h2>å…±æœ‰ãƒ•ã‚¡ã‚¤ãƒ«</h2>
      <button class="modal-close" onclick="closeFileModal()">Ã—</button>
    </div>

    <div class="modal-body">
      <!-- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
      <div class="upload-area">
        <input type="file" id="uploadFileInput">
        <button onclick="uploadFile()">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
      </div>

      <hr>

      <!-- ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ -->
      <div>
        <h3>ã“ã®åˆ©ç”¨è€…ã®ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§</h3>
        <ul id="fileList"></ul>
      </div>
    </div>
  </div>
</div>

</html>
